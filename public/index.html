<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' content='text/html; charset=UTF-8' />
  <meta name='viewport' content='user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0' />
  <meta name='apple-mobile-web-app-capable' content='yes' />
  <title>Ramble</title>
  <link href='css/Ramble.min.css' rel='stylesheet' type='text/css' charset='utf-8' />
  <script src='scripts/modernizr.js' type='text/javascript' charset='utf-8'></script>
  <script src='scripts/SimpleSim.js' type='text/javascript' charset='utf-8'></script>
  <script src='scripts/Ramble.js' type='text/javascript' charset='utf-8'></script>
  </head>
  <body>
    <div id='worldA'></div>
    <div id='scrollBlock'></div>
    <script type='text/javascript' charset='utf-8'>

      var system = SimpleSim.System;
      SimpleSim.Classes = Ramble;

      system.init(null, null, document.getElementById('worldA'), {
        csstransforms3d: true,
        csstransforms: true
      });

      system._records.list[0].afterResize = Ramble.Frog.reflowObjs;

      document.addEventListener('scroll', scrollUpdate, false);

      Ramble.Frog.setTotalColumns();
      Ramble.Frog.setViewportDimensions();
      Ramble.Frog.setControlBlock(document.getElementById('scrollBlock'));

      window.scrollTo(0, 0);

      // create
      for (var i = 0; i < Ramble.Frog.totalColumns; i++) {
        Ramble.Frog.createStory(i);
      }

      function scrollUpdate() {

        if (Ramble.Frog.lastPageYOffset > window.pageYOffset) {
          Ramble.Frog.scrollDirection = 1;
        } else {
          Ramble.Frog.scrollDirection = -1;
        }

        Ramble.Frog.lastPageYOffset = window.pageYOffset;

        //

        var objs = SimpleSim.System.getAllItemsByName('Frog');

        for (var i = 0, max = objs.length; i < max; i++) {
          var obj = objs[i];
          obj.location.y = obj.initLocation.y + (window.pageYOffset * -obj.scrollSpeed);
        }

        Ramble.Frog.scrollDistance = window.pageYOffset;
        controlBlockHeight = parseInt(Ramble.Frog.controlBlock.style.height.replace('px', ''), 10);

        if (Ramble.Frog.scrollDistance + Ramble.Frog.viewportDimensions.height >= controlBlockHeight) {
          Ramble.Frog.controlBlock.style.height = controlBlockHeight + (Ramble.Frog.viewportDimensions.height * 4) + 'px';
        }

      };

    </script>
  </body>
</html>
